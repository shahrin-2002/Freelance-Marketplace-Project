{% extends "core/base.html" %}
{% block title %}Projects{% endblock %}

{% block primary_links %}{{ block.super }}{% endblock %}

{% block content %}
<div class="flex items-center justify-between">
  <h1 class="text-2xl font-semibold tracking-tight">Projects</h1>

  {% if request.user.is_authenticated and request.user.is_client %}
    {% url 'post_project' as post_project_url %}
    {% if post_project_url %}
      <a href="{{ post_project_url }}" class="inline-flex items-center rounded-md bg-brand-600 px-3 py-1.5 text-sm text-white hover:bg-brand-700">
        <i class="fa-solid fa-plus mr-2"></i> Post a Project
      </a>
    {% endif %}
  {% elif request.user.is_authenticated and request.user.is_freelancer %}
    {% url 'project_list' as project_list_url %}
    <a href="{{ project_list_url }}?status=new" class="inline-flex items-center rounded-md bg-brand-600 px-3 py-1.5 text-sm text-white hover:bg-brand-700">
      <i class="fa-solid fa-paper-plane mr-2"></i> Submit a Proposal
    </a>
  {% endif %}
</div>

<form method="get" class="mt-4 flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
  <div class="inline-flex rounded-lg border bg-white p-1 text-sm">
    {% with cur=request.GET.status|default:"" %}
      <a href="?{% if request.GET.skill %}skill={{ request.GET.skill|urlencode }}&{% endif %}status="
         class="px-3 py-1.5 rounded-md {% if not cur %}bg-brand-600 text-white{% else %}hover:bg-gray-50{% endif %}">All</a>
      <a href="?{% if request.GET.skill %}skill={{ request.GET.skill|urlencode }}&{% endif %}status=new"
         class="px-3 py-1.5 rounded-md {% if cur == 'new' %}bg-brand-600 text-white{% else %}hover:bg-gray-50{% endif %}">New</a>
      <a href="?{% if request.GET.skill %}skill={{ request.GET.skill|urlencode }}&{% endif %}status=ongoing"
         class="px-3 py-1.5 rounded-md {% if cur == 'ongoing' %}bg-brand-600 text-white{% else %}hover:bg-gray-50{% endif %}">Ongoing</a>
      <a href="?{% if request.GET.skill %}skill={{ request.GET.skill|urlencode }}&{% endif %}status=completed"
         class="px-3 py-1.5 rounded-md {% if cur == 'completed' %}bg-brand-600 text-white{% else %}hover:bg-gray-50{% endif %}">Completed</a>
    {% endwith %}
  </div>

  <div class="flex gap-2">
    <input type="text" name="skill" list="skills-list" value="{{ request.GET.skill }}"
           placeholder="Filter by skill…"
           class="w-64 rounded-lg border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-500" />
    <datalist id="skills-list">
      {% if skills %}
        {% for s in skills %}
          <option value="{{ s.name }}">
        {% endfor %}
      {% endif %}
    </datalist>
    <button class="rounded-lg border px-3 py-2 text-sm hover:bg-gray-100">Apply</button>
    <a href="{% url 'project_list' %}" class="rounded-lg border px-3 py-2 text-sm hover:bg-gray-100">Reset</a>
  </div>
</form>

{% if projects %}
  <div class="mt-6 space-y-4">
    {% for p in projects %}
      <article class="rounded-xl border bg-white p-5 hover:shadow-sm transition">
        <div class="flex items-start justify-between gap-4">
          <div class="min-w-0">
            {% url 'project_detail' project_id=p.id as detail_url %}
            <a href="{{ detail_url|default:'#' }}" class="block text-lg font-semibold hover:text-brand-700">
              {{ p.title }}
            </a>
            <p class="mt-1 line-clamp-2 text-sm text-gray-600">{{ p.description }}</p>
            <div class="mt-3 flex flex-wrap gap-2">
              {% for s in p.skills.all %}
                <span class="rounded-full bg-gray-100 px-3 py-1 text-xs text-gray-700">{{ s.name }}</span>
              {% endfor %}
            </div>
          </div>
          <div class="text-right shrink-0">
            <div class="mb-2">
              <span class="rounded-full px-2.5 py-1 text-xs font-medium
                {% if p.status == 'completed' %}bg-green-100 text-green-800
                {% elif p.status == 'ongoing' %}bg-amber-100 text-amber-800
                {% else %}bg-gray-100 text-gray-700{% endif %}">
                {{ p.status|default:"new"|title }}
              </span>
            </div>
            <div class="text-sm text-gray-600">Budget</div>
            <div class="font-medium">${{ p.budget|default:"—" }}</div>
          </div>
        </div>
      </article>
    {% endfor %}
  </div>
{% else %}
  <div class="mt-8 rounded-xl border bg-white p-8 text-center text-gray-600">No projects found.</div>
{% endif %}
{% endblock %}
