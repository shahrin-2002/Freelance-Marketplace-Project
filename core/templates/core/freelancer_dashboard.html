{% extends 'core/base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold tracking-tight">Welcome, {{ user.username }} (Freelancer)</h1>

<section class="mt-6 grid gap-6 lg:grid-cols-2">
  <!-- Submitted Proposals -->
  <div class="rounded-2xl border bg-white p-6">
    <h2 class="font-medium">Your Submitted Proposals</h2>
    {% if proposals %}
      <ul class="mt-4 space-y-3">
        {% for proposal in proposals %}
          <li class="rounded-lg border px-4 py-4 hover:bg-gray-50">
            <div class="flex items-start justify-between gap-4">
              <div class="min-w-0">
                <div class="font-medium">
                  Project:
                  <a href="{% url 'project_detail' proposal.project.id %}" class="hover:text-brand-700">
                    {{ proposal.project.title }}
                  </a>
                </div>

                <div class="mt-1 text-sm text-gray-600">
                  Proposed Price: ${{ proposal.proposed_price }}
                </div>
                <div class="text-sm text-gray-600">
                  Message: {{ proposal.message }}
                </div>

                <div class="mt-2 text-sm">
                  Status:
                  {% if proposal.status == 'accepted' %}
                    <span class="rounded-full bg-green-100 px-2 py-0.5 text-green-700">Accepted</span>
                  {% elif proposal.status == 'rejected' %}
                    <span class="rounded-full bg-red-100 px-2 py-0.5 text-red-700">Rejected</span>
                  {% else %}
                    <span class="rounded-full bg-gray-100 px-2 py-0.5 text-gray-700">Pending</span>
                  {% endif %}
                </div>

                <div class="mt-3 flex flex-wrap gap-2">
                  <a href="{% url 'project_detail' proposal.project.id %}"
                     class="inline-flex items-center rounded-md border px-3 py-1.5 text-sm hover:bg-gray-50">
                    <i class="fa-regular fa-folder-open mr-2"></i> View Project
                  </a>

                  {% url 'chat_detail' username=proposal.project.client.username as chat_url %}
                  <a href="{{ chat_url|default:'#' }}"
                     class="inline-flex items-center rounded-md bg-brand-600 px-3 py-1.5 text-sm text-white hover:bg-brand-700">
                    <i class="fa-regular fa-message mr-2"></i> Message Client
                  </a>
                </div>
              </div>

              <div class="shrink-0 text-right text-xs text-gray-500">
                Submitted at {{ proposal.submitted_at }}
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="mt-4 rounded-lg border bg-gray-50 px-4 py-6 text-center text-gray-600">
        You haven't submitted any proposals yet.
      </div>
    {% endif %}
  </div>

  <!-- Client Reviews -->
  <div class="rounded-2xl border bg-white p-6">
    <h2 class="font-medium">Client Reviews</h2>
    {% if reviews %}
      <ul class="mt-4 space-y-3">
        {% for review in reviews %}
          <li class="rounded-lg border px-4 py-3 hover:bg-gray-50">
            <div class="font-medium">Project: {{ review.proposal.project.title }}</div>
            <div class="text-sm text-gray-600">Client: {{ review.proposal.project.client.username }}</div>
            <div class="text-sm text-gray-600">Rating: {{ review.rating }} / 5</div>
            <div class="text-sm text-gray-600">Comment: {{ review.comment }}</div>
            <div class="text-xs text-gray-500 mt-1">Submitted on {{ review.created_at }}</div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="mt-4 rounded-lg border bg-gray-50 px-4 py-6 text-center text-gray-600">
        No reviews received yet.
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
